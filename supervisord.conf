[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
logfile_maxbytes=10MB
loglevel=info
pidfile=/var/run/supervisord.pid

; ── Layer 1: MCP Servers (no inter-service deps) ────────────────────────────

[program:world-data]
command=python mcp-servers/world-data/server.py
directory=/app
autostart=true
autorestart=true
startretries=5
startsecs=3
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=100

[program:finance-monitor]
command=python mcp-servers/finance-monitor/server.py
directory=/app
autostart=true
autorestart=true
startretries=5
startsecs=3
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=100

[program:media-engine]
command=python mcp-servers/media-engine/server.py
directory=/app
autostart=true
autorestart=true
startretries=5
startsecs=3
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=100

; ── Layer 2: Agents ─────────────────────────────────────────────────────────
; MCP clients connect lazily (inside AsyncExitStack at call time, not startup)
; so startup ordering is not critical. autorestart handles rare race conditions.

[program:contextualist]
command=python agents/contextualist_agent/main.py
directory=/app
autostart=true
autorestart=true
startretries=10
startsecs=3
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=200

[program:scout]
command=python agents/scout_agent/main.py
directory=/app
autostart=true
autorestart=true
startretries=10
startsecs=3
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=200

[program:publisher]
command=python agents/publisher_agent/main.py
directory=/app
autostart=true
autorestart=true
startretries=10
startsecs=3
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=200

; ── Layer 3: UI ─────────────────────────────────────────────────────────────

[program:streamlit]
command=streamlit run ui/app.py --server.port 8501 --server.address 127.0.0.1 --server.headless true
directory=/app
autostart=true
autorestart=true
startretries=10
startsecs=5
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=300

; ── Nginx (public entry point) ───────────────────────────────────────────────

[program:nginx]
command=nginx -g "daemon off;"
autostart=true
autorestart=true
startretries=5
startsecs=2
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=400
