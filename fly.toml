app            = "news-brief-generator"
primary_region = "iad"

[build]
  dockerfile = "Dockerfile"

[env]
  # Non-secret service URLs — all localhost since all processes run in one machine
  WORLD_DATA_URL    = "http://127.0.0.1:8001/mcp"
  FINANCE_URL       = "http://127.0.0.1:8002/mcp"
  CONTEXTUALIST_URL = "http://127.0.0.1:8000/mcp"
  MEDIA_ENGINE_URL  = "http://127.0.0.1:8003/mcp"
  SCOUT_URL         = "http://127.0.0.1:8004/mcp"
  PUBLISHER_URL     = "http://127.0.0.1:8005/mcp"
  # post_office.json lives on the Fly Volume, not inside the source tree
  POST_OFFICE_DIR   = "/data/protocol"

[http_service]
  internal_port        = 80
  force_https          = true
  auto_stop_machines   = "off"
  auto_start_machines  = true
  min_machines_running = 1

  [http_service.concurrency]
    type       = "requests"
    soft_limit = 25
    hard_limit = 50

  [[http_service.checks]]
    grace_period = "30s"
    interval     = "15s"
    method       = "GET"
    path         = "/health"
    timeout      = "5s"

[[vm]]
  size   = "shared-cpu-1x"
  memory = "1gb"

[[mounts]]
  source      = "post_office"
  destination = "/data/protocol"

[checks]
  [checks.nginx]
    grace_period = "30s"
    interval     = "15s"
    method       = "GET"
    path         = "/health"
    port         = 80
    timeout      = "5s"
    type         = "http"
    # /health returns 200 OK without auth — unambiguously healthy
